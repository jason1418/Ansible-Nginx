- name: Install NGINX repo
  yum: 
    name: http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm
    state: present

- name: Install NGINX, php, php-fpm
  yum: 
    name: {{ item }}
    state: present
  with_items:
    - nginx
    - php
    - php-fpm
  notify: restart service
  
- name: Create a directory if it does not exist
  file:
    path: {{ Nginx_rootpath }}
    state: directory
    mode: '0755'
  
- name: Config
  template:
    src: {{ item.src }}
    dest: {{ item.desc }}
    mode: '0755'
  with_items:
    - { src: 'template/default.conf.j2', dest: '/etc/nginx/conf.d/default.conf' }
    - { src: 'template/www.conf.j2', dest: '/etc/php-fpm.d/www.conf' }
  notify: reload service

handlers:
  - name: restart service
    service: 
      name: {{ item }}
      state: restarted
    with_items:
      - nginx
      - php-fpm
  
  - name: reload service
    service: 
      name: {{ item }}
      state: reloaded
    with_items:
      - nginx
      - php-fpm
