- name: Install NGINX, php, php-fpm
  apt: 
    name: {{ item }}
    state: present
  with_items:
    - nginx
    - php
    - php-fpm
  notify: restart service
  
- name: Config
  template:
    src: {{ item.src }}
    dest: {{ item.desc }}
    mode: '0755'
  with_items:
    - { src: 'template/default.conf.j2', dest: '/etc/nginx/conf.d/default.conf' }
    - { src: 'template/www.conf.j2', dest: '/etc/php-fpm.d/www.conf' }
  notify: reload service

handlers:
  - name: restart service
    service: 
      name: {{ item }}
      state: restarted
    with_items:
      - nginx
      - php-fpm
  
  - name: reload service
    service: 
      name: {{ item }}
      state: reloaded
    with_items:
      - nginx
      - php-fpm
